<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Expense Tracker</title>
</head>
<body>

    <form onsubmit="savetolocaltostorage(event)">
        <div>
            <label for="nameusertag">choose expense amount:</label>
            <input type="number" name= "name" id ="nameusertag">
            <label for="emailusertag">choose description:</label>
            <input type="text" name="email"  id="emailusertag" >
            <label for="categories">choose a category:</label>
            <select type="radio" name="category" id="categories" >
                <option value = "fuel">fuel</option>
                <option value = "movies">movies</option>
                <option value = "suits">suits</option>
                <option value = "picnic">picnic</option>
                <option value = "travel">travel</option>
            </select>
        <input class="btn" type="submit" value="addexpense">
 </div>
    </form>
    <ul id='listofitems'>   
    </ul>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
    <script>
        function savetolocaltostorage(event){
            event.preventDefault();
            const name=event.target.name.value;
            const email=event.target.email.value;
            const phonenumber=event.target.categories.value;
            const obj = {
            name,
            email,
            phonenumber
            }
            axios
          .post("http://localhost:8007/expense/add-expense", obj)
          .then((response) => {
            console.log(response);
            ShowUserOnScreen(response.data.newuserdetail);
          })
          .catch((err) => {
            console.error(err);
          });
      }
  
      window.addEventListener("DOMContentLoaded", () => {
        axios
          .get("http://localhost:8007/expense/get-expense")
          .then((response) => {
            for (var i = 0; i < response.data.alluser.length; i++) {
              ShowUserOnScreen(response.data.alluser[i]);
            }
          })
          .catch((err) => {
            console.error(err);
          });
      });
  
        
      function   ShowUserOnScreen(user){
        const parentnode = document.getElementById("listofitems");
        const childhtml = `<li id=${user.id}>${user.name}-${user.email}-${user.phonenumber}
            <button onclick="deleteuser('${user.id}')">Delete</button>
            <button onclick="edituserdetails('${user.email}', '${user.name}', '${user.phonenumber}', '${user.id}')">Edit</button>
            </li>`;
        parentnode.innerHTML = parentnode.innerHTML + childhtml;
      }
  
      function edituserdetails(email, name, phonenumber, userid) {
        document.getElementById('nameusertag').value = name;
        document.getElementById('emailusertag').value = email;
        document.getElementById('categories').value = phonenumber;
        deleteuser(userid);
      }
  
      function deleteuser(userid) {
        axios
          .delete(`http://localhost:8007/expense/delete-expense/${userid}`)
          .then((response) => {
            removeuserfromscreen(userid);
          })
          .catch((err) => {
            console.error(err);
          });
      }
  
      function removeuserfromscreen(userid) {
        const parentnode = document.getElementById('listofitems');
        const childnodetobedeleted = document.getElementById(userid);
        if (childnodetobedeleted) {
          parentnode.removeChild(childnodetobedeleted);
        }
      }
    </script>
    
  
</body>

</html>